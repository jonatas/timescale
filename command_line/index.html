
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../toolkit_candlestick/">
      
      
        <link rel="next" href="../videos/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Command Line - The Timescaledb gem</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9B2BMB0TNQ"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9B2BMB0TNQ",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9B2BMB0TNQ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#command-line-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="The Timescaledb gem" class="md-header__button md-logo" aria-label="The Timescaledb gem" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Timescaledb gem
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Command Line
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/timescale/timescaledb-ruby" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The Timescaledb gem" class="md-nav__button md-logo" aria-label="The Timescaledb gem" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Timescaledb gem
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/timescale/timescaledb-ruby" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../migrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migrations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../scenic_views/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scenic Views
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolkit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Toolkit Integration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolkit_lttb_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Toolkit LTTB Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../chat_gpt_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open AI Long Term Storage Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolkit_lttb_zoom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zooming with High Resolution
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../toolkit_candlestick/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Toolkit Candlesticks tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Command Line
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Command Line
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-tsdb-cli" class="md-nav__link">
    <span class="md-ellipsis">
      The tsdb CLI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The tsdb CLI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tsdb-console" class="md-nav__link">
    <span class="md-ellipsis">
      tsdb --console
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Videos
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-tsdb-cli" class="md-nav__link">
    <span class="md-ellipsis">
      The tsdb CLI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The tsdb CLI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tsdb-console" class="md-nav__link">
    <span class="md-ellipsis">
      tsdb --console
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="command-line-application">Command line application<a class="headerlink" href="#command-line-application" title="Permanent link">&para;</a></h1>
<p>When you install the gem locally, a new command line application named <code>tsdb</code> will be available on your command line.</p>
<h2 id="the-tsdb-cli">The <code>tsdb</code> CLI<a class="headerlink" href="#the-tsdb-cli" title="Permanent link">&para;</a></h2>
<p>It accepts a Postgresql URI and some extra flags that can help you to get more info from your TimescaleDB server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>tsdb<span class="w"> </span>&lt;uri&gt;<span class="w"> </span>--stats
</code></pre></div>
<p>Where the <code>&lt;uri&gt;</code> is replaced with params from your connection like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>tsdb<span class="w"> </span>postgres://&lt;user&gt;@localhost:5432/&lt;dbname&gt;<span class="w"> </span>--stats
</code></pre></div>
<p>Or merely check the stats:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>tsdb<span class="w"> </span><span class="s2">&quot;postgres://&lt;user&gt;@localhost:5432/timescaledb_test&quot;</span><span class="w"> </span>--stats
</code></pre></div>
<p>Here is a sample output from a database example with almost no data:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span><span class="ss">:hypertables</span><span class="o">=&gt;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="p">{</span><span class="ss">:count</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">   </span><span class="ss">:uncompressed</span><span class="o">=&gt;</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">   </span><span class="ss">:chunks</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:total</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">:compressed</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">:uncompressed</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">   </span><span class="ss">:size</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:befoe_compressing</span><span class="o">=&gt;</span><span class="s2">&quot;80 KB&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:after_compressing</span><span class="o">=&gt;</span><span class="s2">&quot;0 Bytes&quot;</span><span class="p">}},</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w"> </span><span class="ss">:continuous_aggregates</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:count</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w"> </span><span class="ss">:jobs_stats</span><span class="o">=&gt;[</span><span class="p">{</span><span class="ss">:success</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="ss">:runs</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="ss">:failures</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}</span><span class="o">]</span><span class="p">}</span>
</code></pre></div>
<p>To start a interactive ruby/<a href="https://github.com/pry/pry">pry</a> console use <code>--console</code>:
The console will dynamically create models for all hypertables that it finds
in the database.</p>
<p>Let's consider the <a href="https://gist.github.com/jonatas/95573ad8744994094ec9f284150004f9#file-caggs-sql">caggs.sql</a> as the example of a database.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>psql<span class="w"> </span>postgres://&lt;user&gt;@localhost:5432/playground<span class="w"> </span>-f<span class="w"> </span>caggs.sql
</code></pre></div>
<p>Then use <code>tsdb</code> in the command line with the same URI and <code>--stats</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">tsdb</span><span class="w"> </span><span class="ss">postgres</span><span class="p">:</span><span class="sr">//</span><span class="o">&lt;</span><span class="n">user</span><span class="o">&gt;</span><span class="vi">@localhost</span><span class="p">:</span><span class="mi">5432</span><span class="o">/</span><span class="n">playground</span><span class="w"> </span><span class="o">--</span><span class="n">stats</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">{</span><span class="ss">:hypertables</span><span class="o">=&gt;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="p">{</span><span class="ss">:count</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">   </span><span class="ss">:uncompressed</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">   </span><span class="ss">:approximate_row_count</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;ticks&quot;</span><span class="o">=&gt;</span><span class="mi">352</span><span class="p">},</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">   </span><span class="ss">:chunks</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:total</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">:compressed</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">:uncompressed</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">   </span><span class="ss">:size</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:uncompressed</span><span class="o">=&gt;</span><span class="s2">&quot;88 KB&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:compressed</span><span class="o">=&gt;</span><span class="s2">&quot;0 Bytes&quot;</span><span class="p">}},</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w"> </span><span class="ss">:continuous_aggregates</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:total</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w"> </span><span class="ss">:jobs_stats</span><span class="o">=&gt;[</span><span class="p">{</span><span class="ss">:success</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="ss">:runs</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span><span class="w"> </span><span class="ss">:failures</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}</span><span class="o">]</span><span class="p">}</span>
</code></pre></div>
<p>To have some interactive playground with the actual database using ruby, just
try the same command before changing from <code>--stats</code> to <code>--console</code>:</p>
<h3 id="tsdb-console">tsdb --console<a class="headerlink" href="#tsdb-console" title="Permanent link">&para;</a></h3>
<p>We are using the same database from the previous example for this context which contains a hypertable named <code>ticks</code> and a view called <code>ohlc_1m</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">tsdb</span><span class="w"> </span><span class="ss">postgres</span><span class="p">:</span><span class="sr">//</span><span class="o">&lt;</span><span class="n">user</span><span class="o">&gt;</span><span class="vi">@localhost</span><span class="p">:</span><span class="mi">5432</span><span class="o">/</span><span class="n">playground</span><span class="w"> </span><span class="o">--</span><span class="n">console</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">pry</span><span class="p">(</span><span class="no">Timescale</span><span class="p">)</span><span class="o">&gt;</span>
</code></pre></div>
<p>The <code>tsdb</code> CLI will automatically create ActiveRecord models for hypertables and the continuous aggregates views.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="no">Tick</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="o">=&gt;</span><span class="w"> </span><span class="no">Timescaledb</span><span class="o">::</span><span class="no">Tick</span><span class="p">(</span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w"> </span><span class="ss">symbol</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="ss">price</span><span class="p">:</span><span class="w"> </span><span class="n">decimal</span><span class="p">,</span><span class="w"> </span><span class="ss">volume</span><span class="p">:</span><span class="w"> </span><span class="n">integer</span><span class="p">)</span>
</code></pre></div>
<p>Note that it's only created for this session and will never cache in the
library or any other place.</p>
<p>In this case, the <code>Tick</code> model comes from the <code>ticks</code> hypertable found in the database.
It contains several methods inherited from the <code>acts_as_hypertable</code> macro.</p>
<p>Let's start with the <code>.hypertable</code> method.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="no">Tick</span><span class="o">.</span><span class="n">hypertable</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="o">=&gt;</span><span class="w"> </span><span class="c1">#&lt;Timescaledb::Hypertable:0x00007fe99c258900</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w"> </span><span class="ss">hypertable_schema</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;public&quot;</span><span class="p">,</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w"> </span><span class="ss">hypertable_name</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jonatasdp&quot;</span><span class="p">,</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w"> </span><span class="ss">num_dimensions</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w"> </span><span class="ss">num_chunks</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w"> </span><span class="ss">compression_enabled</span><span class="p">:</span><span class="w"> </span><span class="kp">false</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w"> </span><span class="ss">tablespaces</span><span class="p">:</span><span class="w"> </span><span class="kp">nil</span><span class="o">&gt;</span>
</code></pre></div>
<p>The core of the hypertables is the fragmentation of the data into chunks, the child tables that distribute the data. You can check all chunks directly from the hypertable relation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="no">Tick</span><span class="o">.</span><span class="n">hypertable</span><span class="o">.</span><span class="n">chunks</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">unknown</span><span class="w"> </span><span class="no">OID</span><span class="w"> </span><span class="mi">2206</span><span class="p">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">recognize</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="s1">&#39;primary_dimension_type&#39;</span><span class="o">.</span><span class="w"> </span><span class="no">It</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cast</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nb">String</span><span class="o">.</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="o">=&gt;</span><span class="w"> </span><span class="o">[</span><span class="c1">#&lt;Timescaledb::Chunk:0x00007fe99c31b068</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="ss">hypertable_schema</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;public&quot;</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="ss">hypertable_name</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="ss">chunk_schema</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_timescaledb_internal&quot;</span><span class="p">,</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="ss">chunk_name</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_hyper_33_17_chunk&quot;</span><span class="p">,</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="ss">primary_dimension</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">  </span><span class="ss">primary_dimension_type</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;timestamp without time zone&quot;</span><span class="p">,</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">  </span><span class="ss">range_start</span><span class="p">:</span><span class="w"> </span><span class="mi">1999</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">30</span><span class="w"> </span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="w"> </span><span class="o">+</span><span class="mo">0000</span><span class="p">,</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">  </span><span class="ss">range_end</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">06</span><span class="w"> </span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="w"> </span><span class="o">+</span><span class="mo">0000</span><span class="p">,</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">  </span><span class="ss">range_start_integer</span><span class="p">:</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">  </span><span class="ss">range_end_integer</span><span class="p">:</span><span class="w"> </span><span class="kp">nil</span><span class="p">,</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">  </span><span class="ss">is_compressed</span><span class="p">:</span><span class="w"> </span><span class="kp">false</span><span class="p">,</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">  </span><span class="ss">chunk_tablespace</span><span class="p">:</span><span class="w"> </span><span class="kp">nil</span><span class="o">&gt;]</span>
</code></pre></div>
<blockquote>
<p>Chunks are created by partitioning the hypertable data into one
(or potentially multiple) dimensions. All hypertables are partitions by the
values belonging to a time column, which may be in timestamp, date, or
various integer forms. If the time partitioning interval is one day,
for example, then rows with timestamps that belong to the same day are co-located
within the same chunk, while rows belonging to different days belong to different chunks.
Learn more <a href="https://docs.timescale.com/timescaledb/latest/overview/core-concepts/hypertables-and-chunks/">here</a>.</p>
</blockquote>
<p>Another core concept of TimescaleDB is compression. With data partitioned, it
becomes very convenient to compress and decompress chunks independently.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="no">Tick</span><span class="o">.</span><span class="n">hypertable</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">compress!</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="no">ActiveRecord</span><span class="o">::</span><span class="ss">StatementInvalid</span><span class="p">:</span><span class="w"> </span><span class="no">PG</span><span class="o">::</span><span class="ss">FeatureNotSupported</span><span class="p">:</span><span class="w"> </span><span class="ss">ERROR</span><span class="p">:</span><span class="w">  </span><span class="n">compression</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="s2">&quot;ticks&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="ss">DETAIL</span><span class="p">:</span><span class="w">  </span><span class="no">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compress</span><span class="w"> </span><span class="n">chunks</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hypertable</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">enabled</span><span class="o">.</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="ss">HINT</span><span class="p">:</span><span class="w">  </span><span class="no">Enable</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="no">ALTER</span><span class="w"> </span><span class="no">TABLE</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">timescaledb</span><span class="o">.</span><span class="n">compress</span><span class="w"> </span><span class="n">option</span><span class="o">.</span>
</code></pre></div>
<p>As compression is not enabled, let's do it by executing plain SQL directly from the actual context. To borrow a connection, let's use the Tick object.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="no">Tick</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;ALTER TABLE ticks SET (timescaledb.compress)&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># =&gt; PG_OK</span>
</code></pre></div>
<p>And now, it's possible to compress and decompress:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="no">Tick</span><span class="o">.</span><span class="n">hypertable</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">compress!</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="no">Tick</span><span class="o">.</span><span class="n">hypertable</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">decompress!</span>
</code></pre></div>
Learn more about TimescaleDB compression <a href="https://docs.timescale.com/timescaledb/latest/overview/core-concepts/compression/">here</a>.</p>
<p>The <code>ohlc_1m</code> view is also available as an ActiveRecord:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="no">Ohlc1m</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="o">=&gt;</span><span class="w"> </span><span class="no">Timescaledb</span><span class="o">::</span><span class="no">Ohlc1m</span><span class="p">(</span><span class="ss">bucket</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w"> </span><span class="ss">symbol</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb">open</span><span class="p">:</span><span class="w"> </span><span class="n">decimal</span><span class="p">,</span><span class="w"> </span><span class="ss">high</span><span class="p">:</span><span class="w"> </span><span class="n">decimal</span><span class="p">,</span><span class="w"> </span><span class="ss">low</span><span class="p">:</span><span class="w"> </span><span class="n">decimal</span><span class="p">,</span><span class="w"> </span><span class="ss">close</span><span class="p">:</span><span class="w"> </span><span class="n">decimal</span><span class="p">,</span><span class="w"> </span><span class="ss">volume</span><span class="p">:</span><span class="w"> </span><span class="n">integer</span><span class="p">)</span>
</code></pre></div>
<p>And you can run any query as you do with regular active record queries.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="no">Ohlc1m</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">bucket</span><span class="p">:</span><span class="w"> </span><span class="ss">:desc</span><span class="p">)</span><span class="o">.</span><span class="n">last</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="o">=&gt;</span><span class="w"> </span><span class="c1">#&lt;Timescaledb::Ohlc1m:0x00007fe99c2c38e0</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w"> </span><span class="ss">bucket</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">01</span><span class="w"> </span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="w"> </span><span class="no">UTC</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w"> </span><span class="ss">symbol</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SYMBOL&quot;</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w"> </span><span class="nb">open</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span><span class="mi">13</span><span class="n">e2</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w"> </span><span class="ss">high</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="n">e2</span><span class="p">,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w"> </span><span class="ss">low</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="n">e1</span><span class="p">,</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w"> </span><span class="ss">close</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="n">e2</span><span class="p">,</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w"> </span><span class="ss">volume</span><span class="p">:</span><span class="w"> </span><span class="mi">27600</span><span class="o">&gt;</span>
</code></pre></div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>